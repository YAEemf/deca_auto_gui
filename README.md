# デカ・オート (Deca-Auto)

**Deca-Auto: Automated Optimization of Decoupling Capacitor Combinations in PDN**

デカップリングコンデンサの組み合わせ最適解を自動探索するツールです。  
定義されたコンデンサの中から、アンチレゾナンスの少ない優れた合成インピーダンスを持つ組み合わせを自動で探索します。  
旧CLI版(https://github.com/YAEemf/deca_auto.git) より大幅に機能と探索速度および評価精度が向上しています。  
**NVIDIA GPU無しでも動くようにしました！--force-numpyを指定してください。**

!["実行時スクショ"](Screenshot_main.png)
---

## 概要
- デカップリングコンデンサの組み合わせ自動探索
- MurataやTDK提供の主要な`SPICE`モデルを利用可能（.modファイル）
- コンデンサの基本パラメータ（C / ESR / ESL）を自分で定義して利用可能
- 実装したPDN（組み合わせにおけるコンデンサは常にLoad側から容量が小さい順に並ぶ）

![""](PDN.jpg)

## 動作環境
Python 3.12+  
(GPUを使う場合は) CUDA 12.x

## 使い方
### 1. 実行方法
#### インストール
```bash
python -m pip install -e .
```
#### 通常起動
```bash
python -m deca_auto
```
デフォルトでは http://localhost:8501 でWebアプリが立ち上がります。

#### CLI（tomlを渡さないとconfig.pyのデフォルト値で探索します）
```bash
python -m deca_auto --no-gui --config config.toml
```
[option]
--no-search       探索を行わずZ_cのみ計算
--force-numpy     GPUを使わずCPUのみで探索
--cuda [識別番号]   使用するCUDAデバイスを指定
--verbose         詳細なログ出力
--output          サマリExcelの出力ディレクトリ

### 2. コンデンサ設定方法（全ての数値は指数表記に対応）
コンデンサリスト：
<!-- ![""](Cap_list.png) -->

- **SPICEモデルを利用する** 
  `.mod` ファイルのパス（modelディレクトリ内のモデル拡張子は省略可）をGUIのリストまたは `.tomlファイル` に定義。SPICEモデルを指定時はC / ESR / ESLの指定は不要です。
  
- **LCRパラメータを直接定義する**  
  各コンデンサの C / ESR / ESL などのパラメータをGUIのリストまたは`.tomlファイル` に定義。ESR、ESLを省略した場合はデフォルト値（10mΩ、0.5nH）が適用されます。

**【コンデンサを追加/編集/削除したら必ず`コンデンサリストを更新`を押してください】**

※組み合わせにおけるコンデンサの個数上限に加えて、各コンデンサの`使用数範囲`を個別に指定できます。

範囲入力例：  
`3`（そのコンデンサを必ず3個使う）  
`-5`（そのコンデンサを最大5個使う）  
`2-`（そのコンデンサを2個以上使う）  
`3-5`（そのコンデンサを3～5個使う）  
`未指定`（デフォルト。0～全体の上限個数）

### 3. 探索設定
どのようなインピーダンス特性を持つ組み合わせを探索するのか「目標マスク」と「評価重み」で設定できます。  
各評価項目を個別に算出し、それぞれに対応する`重み`を乗算した数値の総和を`スコア`として扱います。Deca-Autoではより小さい`スコア`を求めて探索します。つまり、重みを増やすとその評価項目に対する影響が大きくなり、自然とその特性に対して優れた組み合わせが最終的に残ります。

![""](Weights.png)  

**それぞれの重みを`大きく`した時の挙動**  
- `Max`：インピーダンスの`最大値`が低い候補が現れやすくなる
- `Mean`：インピーダンスの`平均値`が低い候補が現れやすくなる
- `Area`：目標マスクを`超過した面積`が少ない候補が現れやすくなる
- `Under`：目標マスクを`下回った面積`が少ない候補が現れやすくなる
- `Anti-resonance`：`反共振`（ピーク数とその高さで評価）が少ない候補が現れやすくなる
- `Resonance`：`共振`（急峻な谷の数とその深さで評価）が少ない候補が現れやすくなる
- `Parts`：`総部品数`が少ない組み合わせが現れやすくなる。ただし、大幅に部品数を減らしたければ`探索設定`の`Max total parts`で調整すべき
- `Types`：組み合わせにおけるコンデンサの`種類`が少ない候補が現れやすくなる
- `Flatness`：評価帯域全体で`平滑`な候補が現れやすくなる。ただし、平滑な特性が欲しければ`Anti-resonance`で調整する事をお勧めする
- `MC worst`：部品特性のばらつき（常に1.0で良い）　　

**重みによる探索操作の例**  
- 目標マスクに忠実に沿わせたい時：`Area`と`Under`を共に大きくする → マスクを超えても下回ってもスコアが悪化 → マスクに沿った候補が生き残る  
- 部品数や種類がなるべく少ない候補が欲しい時：**`Max total parts`で許容できる部品数上限を設定**した上で`Parts`や`Type`を大きくする  
- 共振の目立つ荒い特性でもなるべく低いインピーダンス特性が欲しい時：`Under`と`Resonance`を下げる  

---

## 👤 Author
- やえ
- https://x.com/nihon_niosumai （Twitter）

## 📄 License
- MIT (お好きに役立ててください)
---
